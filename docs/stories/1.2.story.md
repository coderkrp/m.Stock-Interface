# <!-- Powered by BMAD™ Core -->
# Story 1.2: Refactor for Maintainability

## Status
Draft

## Story
**As a** developer,
**I want** to refactor the single `interface.py` file into a more modular structure (e.g., `src/main.py`, `src/models.py`, `src/security.py`),
**so that** the codebase is more maintainable and easier to extend.

## Acceptance Criteria
1. The application logic is split into logical modules inside a `src` directory.
2. The application runs correctly after the refactoring.
3. All tests from Story 1 continue to pass.

## Tasks / Subtasks
- [x] Task 1 (AC: 1): Create the `src` directory at the project root.
- [x] Task 2 (AC: 1): Move `interface.py` content into `src/main.py`.
- [x] Task 3 (AC: 1): Create `src/models.py` and move Pydantic models from `src/main.py` (if any) to `src/models.py`.
- [x] Task 4 (AC: 1): Create `src/settings.py` and move application settings (if any) to `src/settings.py`.
- [x] Task 5 (AC: 1): Create `src/security.py` (placeholder for future throttling middleware, as per architecture).
- [x] Task 6 (AC: 2, 3): Update imports and references in `src/main.py` and other new `src` files to reflect the modular structure.
- [x] Task 7 (AC: 2, 3): Update `tests/test_interface.py` to reflect the new `src` structure and ensure all tests continue to pass. Consider renaming `test_interface.py` to `test_main.py` or similar if appropriate.
- [ ] Task 8 (AC: 2, 3): Run all tests to ensure the application runs correctly and all tests from Story 1 continue to pass.
- [ ] Task 9: Ensure code is formatted with `black` and linted with `ruff`.

## Dev Notes
### Previous Story Insights
- `pytest` and `slowapi` were added to `requirements.txt`.
- `tests` directory was created with `test_interface.py` and `conftest.py`.
- `interface.py` was refactored for logging, `get_trades` endpoint, and `get_ltp` response handling.
- All tests are passing.

### Data Models
Existing data models (if any, currently in `interface.py`) should be moved to `src/models.py`. [Source: architecture/source-tree-integration.md]

### API Specifications
FastAPI app and routes from `interface.py` will be moved to `src/main.py`. [Source: architecture/source-tree-integration.md]

### File Locations
The new modular structure should be:
```
project-root/
├── src/
│   ├── __init__.py
│   ├── main.py         # FastAPI app and routes
│   ├── models.py       # Pydantic models
│   ├── settings.py     # Pydantic settings
│   └── security.py     # Throttling middleware
├── tests/
│   ├── __init__.py
│   └── test_main.py    # Tests for the API
└── requirements.txt
```
[Source: architecture/source-tree-integration.md]

### Testing
- `pytest` is the designated testing framework. [Source: architecture/testing-strategy.md]
- Tests should be organized in the `tests` directory. [Source: architecture/testing-strategy.md]
- Existing tests (`test_interface.py`) need to be adapted to the new `src` directory structure and potentially moved/renamed to `test_main.py` or similar, ensuring they continue to pass. [Source: architecture/testing-strategy.md, Story 1.2 AC 3]
- Code should be formatted with `black` and linted with `ruff`. [Source: architecture/coding-standards-and-conventions.md]

### Technical Constraints
- Use Python 3.11. [Source: architecture/tech-stack-alignment.md]
- Use FastAPI, Uvicorn, mStock-TradingApi-A, Pydantic, `slowapi`, and `pytest`. [Source: architecture/tech-stack-alignment.md]

### QA Assessments
- Risk Profile: [docs/qa/assessments/1.2-risk-20250902.md](docs/qa/assessments/1.2-risk-20250902.md)
- Test Design: [docs/qa/assessments/1.2-test-design-20250902.md](docs/qa/assessments/1.2-test-design-20250902.md)

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-09-02 | 1.0 | Initial draft | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used

### Debug Log References

### Completion Notes List

### File List
- `src/`
- `src/main.py` (content moved, imports updated)
- `interface.py` (content moved)
- `src/models.py` (new)
- `src/settings.py` (new)
- `src/security.py` (new)
- `tests/test_main.py` (renamed from `tests/test_interface.py`, imports updated)

## QA Results
